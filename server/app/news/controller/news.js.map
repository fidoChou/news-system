{
    "version": 3,
    "sources": [
        "../../../src/news/controller/news.js"
    ],
    "names": [
        "fetchAction",
        "setCorsHeader",
        "where",
        "get",
        "console",
        "log",
        "news",
        "model",
        "fetchNews",
        "__this",
        "promise",
        "forEach",
        "item",
        "index",
        "push",
        "resolve",
        "reject",
        "news_id",
        "id",
        "select",
        "link",
        "cate",
        "cate_id",
        "data",
        "author_id",
        "user",
        "res",
        "uncate",
        "unlink",
        "all",
        "results",
        "map",
        "extra",
        "success",
        "delcateAction",
        "delete",
        "affectedRows",
        "removeAction",
        "header",
        "think",
        "controller",
        "base"
    ],
    "mappings": "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",
    "file": "../../../src/news/controller/news.js",
    "sourcesContent": [
        "'use strict';\nexport default class extends think.controller.base {\n  async fetchAction(){\n  \tthis.setCorsHeader();\n    let where = this.get()\n    console.log(news)\n  \tlet news = await this.model(`news`).fetchNews(where);\n    let __this = this;\n    let promise = [];\n\n\n    news.forEach((item,index)=>{\n      promise.push(new Promise(async (resolve,reject)=>{    \n        let link = await __this.model(`news_cate`).where({news_id:item.id}).select(); \n        \n        // 查询到所有分类\n        link.forEach(async (item,index)=>{\n          let cate = \"cate\";\n          let data = await __this.model(`category`).where({id:item.cate_id}).select()\n            link[index][cate] = data[0]; \n        })\n\n        // unlink.forEach(async(item,index)=>{\n        //   let uncate = 'uncate';\n        //   let data = await __this.model(`category`).where({id:item.cate_id}).select();\n        //     unlink[index][uncate] = data[0]\n        // })        \n        let user =await __this.model(`user`).where({id:item.author_id}).select();\n        let res = {\n          cate:link,\n          uncate: unlink,\n          user: user\n        }\n        resolve(res)\n      }))\n    });\n    let results = await Promise.all(promise);\n    news.map((item,index)=>{\n      let extra = 'extra';\n      return item[extra] = results[index]\n    })\n  \treturn this.success(news);\n  }\n  // 删除分类\n  async delcateAction(){\n    this.setCorsHeader();\n    let where = this.get();\n    let affectedRows = await this.model(`news_cate`).where(where).delete();\n    console.log(affectedRows)\n\n  }\n  // 获取分类：包括已选分类和未选分类\n  // async getcateAction(){\n  //   this.setCorsHeader();\n  //   let where = this.get();\n  //   let user = {};\n  //   let {id} = where;\n  //   if(id){\n  //     user.id = id\n  //   }\n  //   let data = await this.model(`category`).select();\n  //   return this.success(data)\n  // }\n\n  // 删除新闻\n  async removeAction(){\n    this.setCorsHeader();\n    let model = this.model(`news`);\n    let id = this.get(`id`);\n    let affectedRows = await model.where({id:id}).delete()\n    return this.success(affectedRows);\n  }\n  setCorsHeader(){\n    this.header(\"Access-Control-Allow-Origin\", this.header(\"origin\") || \"*\");\n    this.header(\"Access-Control-Allow-Headers\", \"x-requested-with,Content-Type\");\n    this.header(\"Access-Control-Allow-Methods\", \"GET,POST,OPTIONS,PUT,DELETE\");\n    this.header(\"Access-Control-Allow-Credentials\", \"true\");\n  }\n}"
    ]
}